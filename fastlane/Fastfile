fastlane_version '2.216.0 '

before_all do
  # ensure_git_branch
  # ensure_git_status_clean
  # git_pull
end

platform :ios do
    # iOS Lanes
  desc "Run SwiftLint to check for code style violations"
  lane :lint do
    swiftlint(
      mode: :lint,
      output_file: "swiftlint_report.json",
      ignore_exit_status: true,
      config_file: ".swiftlint.yml",
      reporter: "json",
      quiet: true,
      strict: true)
  end

  desc "Run tests"
  lane :test do
    setup_ci(force: true) if ENV['CI']
    match(type: 'development', app_identifier: 'com.jerryokafor.networth', readonly: true)

    scan(
      project: './iosApp/iosApp.xcodeproj',
      scheme: 'iosApp',
      configuration: "Debug")
    end

  desc "Build the app"
  lane :build do
    setup_ci(force: true) if ENV['CI']
    match(type: 'development', app_identifier: 'com.jerryokafor.networth', readonly: true)
    gym(
      project: './iosApp/iosApp.xcodeproj',
      scheme: 'iosApp',
      configuration: "Release",
      export_method: 'development',
      export_options: {
          provisioningProfiles: {
            "com.jerryokafor.networth" => "match Development com.jerryokafor.networth",
          }
        }
      )
    end
end


platform :android do
  # Android Lanes
  lane :beta do
    gradle(task: ':android:clean')
      gradle(
        task: ':android:assemble',
        build_type: 'Release'
      )
    end
end